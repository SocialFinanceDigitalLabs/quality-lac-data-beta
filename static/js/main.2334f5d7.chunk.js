(this["webpackJsonpquality-lac-data-beta"]=this["webpackJsonpquality-lac-data-beta"]||[]).push([[0],{185:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),i=n(38),a=n.n(i),o=n(6),l=n(12),s=n(63),d=n(33),u=n(21),j=n(95),b=n(11),f=n.n(b),h=n(22),p=n(8),O=n(17),v="\n-----BEGIN RSA PUBLIC KEY-----\nMIICCgKCAgEAtIIMSI/vwErk16clFAE5BC6FrKeR3ihH8Hgjy6wATMrxXiOU1u9+\nYPCI1M17bECMey0XpnEtt0SJR8zhsqNlR4XT5NahhiKPLdrj35t0+/2hgyQ9C4Gm\njx/Y9hEdgD6yRbFhPIK22zE0Sadfxl3KxSy33Meh3UO6n47cGG4jhHmH5HF3+aI/\n7VFYaxTF2B4yrfX0PAwzI9nEsezX1H/P4SgwCicHtqt2EbhQ5OWNNpsboUVhF+sa\ninAWjN3cn4VLY9mQGdeISeVQrFFTS6kNrHZkeNxI846BGxeHV7OiPie4SiQby4h9\n1FOvQyjq37FbeX1eehiSbFYvuZ00Fh3wDNlKWDMYUV+U2nJQQX10c1pWRw3vfqgw\nOhGoYeXVe2/uM40nM333b5zErpCGy/gfTu4rhwUQx1ujiUdCkZiwy6UqduV1JOvD\n0JDpce+rXKw69JSxfof5x4DFEG2qk3bcD4SwiVyQBOiGmCYELXjGQamezm3xqnlg\nCBDwdIITa4Xxax3gIxG1nir86Idiy1OA4jXFPN5LESB1Ydvbd26roHrSdy027vAh\nfp17wHu2FOeGCoWN7fkHD8ncWZkYA61WOgwj9Q3K5VeBHJAS9puLda9TzS8NRR1B\na0Jal2jsQ7ISFw/eo//fdF9xnxTxuRCbj2+6QGvBpi2N8Z6O4yikBdECAwEAAQ==\n-----END RSA PUBLIC KEY-----\n",g=n(194),x=n(19),y=function(e,t){try{x.a(e,t)}catch(n){}};function m(e,t,n){return w.apply(this,arguments)}function w(){return(w=Object(h.a)(f.a.mark((function e(t,n,r){var c,i,a,o,l,s,d,u,j,b;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=window.pyodide,console.log("Passing uploaded data to Pyodide..."),o.globals.set("uploaded_files",t),o.globals.set("error_codes",n.filter((function(e){return e.selected})).map((function(e){return e.code}))),o.globals.set("metadata",r),l=[],e.prev=6,e.next=9,o.runPythonAsync('\n        from validator903.validator import Validator\n        from validator903.report import Report\n        from validator903.config import errors as configured_errors\n        from dataclasses import asdict\n        \n        validator = Validator(metadata.to_py(), uploaded_files.to_py())\n        result = validator.validate(error_codes.to_py())\n        print("Finished Validating")\n        \n        report = Report(result)\n        print("Created report")\n        \n        cr = report.child_report\n        print("Child report generated")\n        \n        js_files = {k: [t._asdict() for t in df.itertuples(index=True)] for k, df in validator.dfs.items()}\n        \n        error_definitions = {code: asdict(definition[0]) for code, definition in configured_errors.items()}\n\n        errors = {}\n        for row in report.child_report.itertuples():\n            errors.setdefault(row.Table, {}).setdefault(row.RowID, []).append(row.Code)\n                \n      ');case 9:e.next=18;break;case 11:e.prev=11,e.t0=e.catch(6),console.error("Caught Error!",e.t0),s=e.t0.toString(),y(e.t0,{pythonError:s}),d=s.split("\n"),l.push(d[d.length-2]);case 18:return u=null===(c=o.globals.get("js_files"))||void 0===c?void 0:c.toJs(),j=null===(i=o.globals.get("errors"))||void 0===i?void 0:i.toJs(),b=null===(a=o.globals.get("error_definitions"))||void 0===a?void 0:a.toJs(),console.log("Python calculation complete."),e.abrupt("return",[{data:u,errors:j,errorDefinitions:b},l]);case 23:case"end":return e.stop()}}),e,null,[[6,11]])})))).apply(this,arguments)}function C(){return E.apply(this,arguments)}function E(){return(E=Object(h.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=window.pyodide)||void 0===t?void 0:t.runPython){e.next=16;break}return e.next=3,window.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.18.0/full/"});case 3:return window.pyodide=e.sent,e.next=6,window.pyodide.loadPackage(["micropip"]);case 6:return console.log("Loaded pyodide, now loading custom library..."),window.pyodide.globals.set("pc_pubkey",v),e.next=10,window.pyodide.runPythonAsync('\n      import os\n      os.environ["QLACREF_PC_KEY"] = pc_pubkey\n    ');case 10:return Object({NODE_ENV:"production",PUBLIC_URL:"/quality-lac-data-beta",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GA_MEASUREMENT_ID:"G-S8FK1TK7L9",REACT_APP_SENTRY_DSN:"https://befe29a929f64c6a96b3f7e8e0bb82ab@o108858.ingest.sentry.io/6075367",REACT_APP_VALIDATOR_RELEASE:"quality-lac-data-validator==0.2.0a2"}).REACT_APP_MICROPIP_MODULES&&(n=Object({NODE_ENV:"production",PUBLIC_URL:"/quality-lac-data-beta",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GA_MEASUREMENT_ID:"G-S8FK1TK7L9",REACT_APP_SENTRY_DSN:"https://befe29a929f64c6a96b3f7e8e0bb82ab@o108858.ingest.sentry.io/6075367",REACT_APP_VALIDATOR_RELEASE:"quality-lac-data-validator==0.2.0a2"}).REACT_APP_MICROPIP_MODULES.split(" "),window.pyodide.globals.set("micropip_extra_modules",n)),e.next=13,window.pyodide.runPythonAsync("\n      import micropip\n      import logging\n      logging.basicConfig(level=logging.INFO)\n     \n      await micropip.install('".concat("quality-lac-data-validator==0.2.0a2",'\')\n\n      try:\n        for mod in micropip_extra_modules:\n          print(f"Loading extra module from: {mod}")\n          await micropip.install(mod)\n      except NameError:\n        pass\n    '));case 13:console.log("Loaded custom libary."),e.next=17;break;case 16:console.log("Pyodide already loaded.");case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return _.apply(this,arguments)}function _(){return(_=Object(h.a)(f.a.mark((function e(){var t,n,r,c,i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=window.pyodide,e.next=3,t.runPythonAsync("\n    from validator903.config import errors as configured_errors\n    all_error_definitions = [definition[0] for definition in configured_errors.values()]\n  ");case 3:n=window.pyodide.globals.get("all_error_definitions"),r=[],c=Object(u.a)(n);try{for(c.s();!(i=c.n()).done;)a=i.value,r.push({code:a.code,description:a.description,affectedFields:a.affected_fields,selected:!0})}catch(o){c.e(o)}finally{c.f()}return e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k=n(3);function A(e){var t,n=e.childIds,r=e.selected,c=e.setSelected,i=[],a=Object(u.a)(n.sort((function(e,t){return e[0].toString().localeCompare(t[0].toString())})).entries());try{var l=function(){var e=Object(p.a)(t.value,2),n=e[0],a=Object(p.a)(e[1],2),l=a[0],s=a[1],d=l,u=null;l===r&&(d=null,u={backgroundColor:"#ccc"}),i.push(Object(k.jsx)(o.s.Row,{children:Object(k.jsxs)(o.s.Cell,{onClick:function(){return c(d)},style:u,children:[Object(k.jsx)("div",{style:{float:"left",paddingLeft:"10px"},children:l}),Object(k.jsx)("div",{style:{float:"right",fontSize:"0.8em",paddingRight:"10px"},children:s>0?"".concat(s," errors"):"OK"})]},n)},n))};for(a.s();!(t=a.n()).done;)l()}catch(s){a.e(s)}finally{a.f()}return Object(k.jsx)("div",{style:{overflowY:"scroll",height:"100vh"},children:Object(k.jsx)(o.s,{style:{fontSize:"1em"},children:i})})}var F,D="Header",T="CHILD",P=n(31),R=n(1),L=R.b.div(F||(F=Object(P.a)(["\ntable {\n  font-size: 14px;\n}\n\ntd {\n  padding: 5px;\n}\n\n.error {\n  color: #D8000C;\n  background-color: #FFD2D2;\n}\n"])));function I(e){var t=e.rowData,n=e.highlight,r=[],c=[];if(t&&t.length>0){var i,a=Object(u.a)(Array.from(t[0].keys()).entries());try{for(a.s();!(i=a.n()).done;){var l=Object(p.a)(i.value,2),s=l[0],d=l[1];r.push(Object(k.jsx)(o.s.CellHeader,{children:d},s))}}catch(_){a.e(_)}finally{a.f()}var j,b=Object(u.a)(t.entries());try{for(b.s();!(j=b.n()).done;){var f,h=Object(p.a)(j.value,2),O=h[0],v=h[1],g=[],x=Object(u.a)(Array.from(v.entries()).entries());try{for(x.s();!(f=x.n()).done;){var y=Object(p.a)(f.value,2),m=y[0],w=Object(p.a)(y[1],2),C=w[0],E=w[1],S=n&&n.has(JSON.stringify([v.get("Index"),C]));g.push(Object(k.jsx)(o.s.Cell,{className:S?"error":null,children:Number.isNaN(E)||void 0===E?"[null]":E.toString()},m))}}catch(_){x.e(_)}finally{x.f()}c.push(Object(k.jsx)(o.s.Row,{children:g},O))}}catch(_){b.e(_)}finally{b.f()}return Object(k.jsx)(L,{children:Object(k.jsxs)(o.s,{children:[Object(k.jsx)(o.s.Row,{children:r}),c]})})}return Object(k.jsx)(o.o,{children:"No data found for table."})}function M(e){var t=e.tableData,n=e.errorLocations,c=e.excludedTable,i=Object(r.useState)(0),a=Object(p.a)(i,2),l=a[0],s=a[1],d=Array.from(t.keys()).filter((function(e){return e!==c}));d.sort();var u=Array.from(d.entries()).map((function(e){var t=Object(p.a)(e,2),n=t[0],r=t[1];return Object(k.jsx)(o.t.Tab,{onClick:function(){return s(n)},selected:l===n,children:r},n)})),j=Array.from(d.entries()).map((function(e){var r=Object(p.a)(e,2),c=r[0],i=r[1];return Object(k.jsx)(o.t.Panel,{selected:l===c,style:{overflowX:"auto"},children:Object(k.jsx)(I,{rowData:t.get(i),highlight:n.get(i)})},c)}));return Object(k.jsxs)(o.t,{children:[Object(k.jsx)(o.t.Title,{children:"Upload"}),Object(k.jsx)(o.t.List,{children:u}),j]})}var N,H=n(90),V=R.b.div(N||(N=Object(P.a)(["\n.floatingContainer {\n  display: block;\n  position: relative;\n  padding: 10px 10px;\n  top: 0;\n  left: 100px;\n  width: 300px;\n  height: 300px;\n  margin-top: 5px;\n  margin-bottom: -327px;\n  border: 1px solid black;\n  background-color: #fff;\n  font-size: 10px;\n}  \n\n.floatingClose {\n  cursor: pointer;\n  float: right;\n  position: relative;\n  top: -23px;\n  left: 10px;\n}\n\ninput {\n  height: 13px;\n  width: 180px;\n}\n\n.errorFilter {\n  height: 250px;\n  overflow-y: scroll;\n  padding-right: 10px;\n}\n\ntable {\n  font-size: 10px;\n}\n\n.selectedError {\n  background-color: #ccc;\n}\n"])));function K(e){var t=e.validatedData,n=e.setChildFilter,c=e.setErrorFilter,i=e.setShown,a=e.innerRef,l=Object(r.useState)(""),s=Object(p.a)(l,2),d=s[0],u=s[1],j=Object(r.useState)(null),b=Object(p.a)(j,2),f=b[0],h=b[1],O=Object(r.useMemo)((function(){var e=new Map;t.errors.forEach((function(t){t.forEach((function(t){t.forEach((function(t){e.set(t,e.get(t)?e.get(t)+1:1)}))}))}));var n=Array.from(e.entries());return n.sort((function(e,t){var n=Object(p.a)(e,2)[1];return Object(p.a)(t,2)[1]-n})),n.map((function(e){var n=Object(p.a)(e,2),r=n[0],c=n[1],i=t.errorDefinitions.get(r),a=r===f;return Object(k.jsxs)(o.s.Row,{className:a?"selectedError":null,onClick:function(){return h(a?null:r)},children:[Object(k.jsx)(o.s.Cell,{children:r}),Object(k.jsx)(o.s.Cell,{children:null===i||void 0===i?void 0:i.get("description")}),Object(k.jsx)(o.s.Cell,{children:c})]},r)}))}),[t,f]);Object(r.useEffect)((function(){n(d)}),[d,n]),Object(r.useEffect)((function(){c(f)}),[f,c]);var v=Object(r.useCallback)((function(){u(""),h(null)}),[u]);return Object(k.jsx)(V,{children:Object(k.jsxs)("div",{ref:a,className:"floatingContainer",children:[Object(k.jsx)(H.DebounceInput,{minLength:2,debounceTimeout:150,onChange:function(e){return u(e.target.value)},value:d,placeholder:"Enter a child ID to filter..."}),Object(k.jsx)("span",{onClick:function(){return i(!1)},className:"floatingClose",children:"[x]"}),Object(k.jsx)("button",{style:{float:"right"},onClick:v,children:"Clear filters"}),Object(k.jsx)("p",{children:"Click each row to filter for only that error type."}),Object(k.jsx)("div",{className:"errorFilter",children:Object(k.jsxs)(o.s,{children:[Object(k.jsxs)(o.s.Row,{children:[Object(k.jsx)(o.s.CellHeader,{children:"Code"}),Object(k.jsx)(o.s.CellHeader,{children:"Message"}),Object(k.jsx)(o.s.CellHeader,{children:"Count"})]}),O]})})]})})}function Y(e){var t=e.validatedData,n=Object(r.useState)(null),c=Object(p.a)(n,2),i=c[0],a=c[1],l=Object(r.useState)(null),s=Object(p.a)(l,2),d=s[0],j=s[1],b=Object(r.useState)(null),O=Object(p.a)(b,2),v=O[0],g=O[1],x=Object(r.useState)(!1),y=Object(p.a)(x,2),m=y[0],w=y[1],C=Object(r.useRef)(null);Object(r.useEffect)((function(){return window.scrollTo(0,0)}),[]),Object(r.useEffect)((function(){var e=function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:C.current&&!C.current.contains(t.target)&&w(!1);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return document.addEventListener("click",e),function(){document.removeEventListener("click",e)}}),[C]);var E=Object(r.useMemo)((function(){var e=new Map;return t.data.forEach((function(n,r){e.set(r,function(e,t,n){var r,c=[];return null===(r=e.get(n))||void 0===r||r.forEach((function(e){e.get(T)===t&&c.push(e)})),c}(t.data,v,r))})),e}),[t,v]),S=Object(r.useMemo)((function(){var e=new Map;return t.errors.forEach((function(n,r){var c=new Set;n.forEach((function(e,n){e.forEach((function(e){var r;(null===(r=t.errorDefinitions.get(e))||void 0===r?void 0:r.get("affected_fields")).forEach((function(e){c.add(JSON.stringify([n,e]))}))}))})),e.set(r,c)})),e}),[t]),_=Object(r.useMemo)((function(){var e=function(e){var t=e.data,n=e.errors,r=new Map;return t.forEach((function(e,t){e.forEach((function(e){var c,i=e.get(T);r.has(i)||r.set(i,[]);var a=e.get("Index"),o=null===(c=n.get(t))||void 0===c?void 0:c.get(a);o&&o.forEach((function(e){var t;return null===(t=r.get(i))||void 0===t?void 0:t.push(e)}))}))})),r}(t);return Array.from(e.entries())}),[t]),F=Object(r.useMemo)((function(){var e,t=[],n=Object(u.a)(_);try{for(n.s();!(e=n.n()).done;){var r=Object(p.a)(e.value,2),c=r[0],a=r[1].filter((function(e){return!d||e===d})).length;(!i||c.toString().includes(i))&&(!d||a>0)&&t.push([c,a])}}catch(o){n.e(o)}finally{n.f()}return t}),[_,i,d]),P=Object(r.useMemo)((function(){var e=function(e,t){var n=e.data,r=e.errors;if(!t)return[];var c=[];return n.forEach((function(e,n){e.forEach((function(e){if(e.get(T)===t){var i,a=e.get("Index"),o=null===(i=r.get(n))||void 0===i?void 0:i.get(a);o&&o.forEach((function(e){return c.push(e)}))}}))})),c}(t,v),n=function(e){var n=t.errorDefinitions.get(e);return"Error ".concat(null===n||void 0===n?void 0:n.get("code")," - ").concat(null===n||void 0===n?void 0:n.get("description"))};return Array.from(e.entries()).map((function(e){var t=Object(p.a)(e,2),r=t[0],c=t[1];return Object(k.jsx)(o.m,{style:{fontSize:"1em"},children:n(c)},r)}))}),[t,v]);return Object(k.jsx)(k.Fragment,{children:Object(k.jsxs)(o.h,{mb:5,children:[Object(k.jsxs)(o.g,{setWidth:"200px",children:[Object(k.jsxs)("div",{children:[Object(k.jsx)(o.j,{mb:8,style:{display:"inline",marginRight:"10px"},children:"Child ID"}),Object(k.jsx)("button",{onClick:function(e){e.stopPropagation(),w(!m)},style:{display:"inline",backgroundColor:i||d?"#a7c2d1":void 0},children:"Filter"})]}),m&&Object(k.jsx)(K,{innerRef:C,validatedData:t,setChildFilter:a,setErrorFilter:j,setShown:w}),Object(k.jsx)(A,{childIds:F,selected:v,setSelected:g})]}),Object(k.jsx)(o.g,{children:v?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsxs)("div",{style:{width:"50%"},children:[Object(k.jsx)(o.j,{children:"Header"}),Object(k.jsx)(I,{rowData:E.get(D),highlight:S.get(D)})]}),Object(k.jsx)(o.q,{mb:9}),Object(k.jsx)(M,{tableData:E,errorLocations:S,excludedTable:D}),P.length>0?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(o.j,{children:"Errors"}),Object(k.jsx)(o.u,{style:{fontSize:"1em"},children:P})]}):Object(k.jsx)(k.Fragment,{})]}):Object(k.jsx)(o.b,{children:"Select a child..."})})]})})}var U,G,B=n(94),W=R.b.div(U||(U=Object(P.a)(["\n  border: 2px dashed #999999;\n  padding: 5px;\n  color: #666666;\n\n  ul, li {\n    color: #666666;\n  }\n"])));function X(e){var t=e.onFiles,n=e.description,c=e.accept,i=e.displayedFiles,a=Object(r.useState)(),l=Object(p.a)(a,2),s=l[0],u=l[1],j=Object(r.useCallback)((function(e,r){t({description:n,acceptedFiles:e}),r.forEach((function(e){u(e.errors[0].message)}))}),[u,n,t]),b=Object(B.a)({onDrop:j,accept:c}),f=b.getRootProps,h=b.getInputProps,O=b.isDragActive;return Object(k.jsxs)(W,Object(d.a)(Object(d.a)({},f()),{},{children:[Object(k.jsx)("input",Object(d.a)({},h())),i.length>0&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(o.o,{mb:1,children:"Located files (click to add more):"}),Object(k.jsx)(o.u,{mb:1,children:i.map((function(e){return Object(k.jsx)(o.m,{children:e.name},e.name)}))})]}),s?Object(k.jsx)("p",{style:{color:"red"},children:s}):O?Object(k.jsx)("p",{children:"Drop the files here ..."}):0===i.length?Object(k.jsx)("p",{children:"Drag and drop some files here, or click to select files"}):null]}))}var z=R.b.div(G||(G=Object(P.a)(["\n.disabled {\n  opacity: 50%;\n  pointer-events: none;\n}\n\n.disabledMode {\n  opacity: 50%;\n  pointer-events: none;\n  text-decoration: line-through;\n}\n"])));function Q(e){var t=e.currentFiles,n=e.addFileContent,c=e.uploadErrors,i=(e.selectedErrors,e.setSelectedErrors,Object(r.useState)("csv")),a=Object(p.a)(i,2),l=a[0],s=a[1],d=Object(r.useCallback)((function(e){var t=e.description;e.acceptedFiles.forEach((function(e){var r=new FileReader;r.onabort=function(){return console.log("File reading failed.")},r.onerror=function(){return console.log("File reading error.")},r.onload=function(){var c=r.result;console.log("Finished reading (".concat(t,") file ").concat(e.name,".")),n({name:e.name,description:t,fileText:c})},r.readAsArrayBuffer(e)}))}),[n]);return Object(k.jsxs)(z,{children:[Object(k.jsx)(o.o,{children:"This tool will not send data to any third party. It uses the browser as an application to locate files in your computer and run scripts on them to identify errors. Once the browser is loaded, you can locate the files and run the validation offline."}),Object(k.jsxs)(o.t,{children:[Object(k.jsx)(o.t.Title,{children:"Locate"}),Object(k.jsxs)(o.t.List,{children:[Object(k.jsx)(o.t.Tab,{onClick:function(){return s("csv")},selected:"csv"===l,className:"csv"!==l&&t.length>0?"disabledMode":null,children:"CSV Files"}),Object(k.jsx)(o.t.Tab,{onClick:function(){return s("xml")},selected:"xml"===l,className:"xml"!==l&&t.length>0?"disabledMode":null,children:"XML Files"})]}),Object(k.jsx)(o.t.Panel,{selected:"csv"===l,children:Object(k.jsxs)(o.h,{children:[Object(k.jsxs)(o.g,{children:[Object(k.jsx)(o.k,{children:"This year"}),Object(k.jsx)(X,{description:"This year (CSV)",onFiles:d,accept:".csv",displayedFiles:t.filter((function(e){return"This year (CSV)"===e.description}))})]}),Object(k.jsxs)(o.g,{setWidth:"one-half",className:t.length>0?null:"disabled",children:[Object(k.jsx)(o.k,{children:"Previous year"}),Object(k.jsx)(X,{description:"Prev year (CSV)",onFiles:d,accept:".csv",displayedFiles:t.filter((function(e){return"Prev year (CSV)"===e.description}))})]})]})}),Object(k.jsx)(o.t.Panel,{selected:"xml"===l,children:Object(k.jsxs)(o.h,{children:[Object(k.jsxs)(o.g,{children:[Object(k.jsx)(o.k,{children:"This year"}),Object(k.jsx)(X,{description:"This year (XML)",onFiles:d,accept:".xml",displayedFiles:t.filter((function(e){return"This year (XML)"===e.description}))})]}),Object(k.jsxs)(o.g,{setWidth:"one-half",className:t.length>0?null:"disabled",children:[Object(k.jsx)(o.k,{children:"Previous year"}),Object(k.jsx)(X,{description:"Prev year (XML)",onFiles:d,accept:".xml",displayedFiles:t.filter((function(e){return"Prev year (XML)"===e.description}))})]})]})})]}),c.length>0?Object(k.jsx)(o.d,{summary:"Errors",open:!0,children:Array.from(c.entries(),(function(e){var t=Object(p.a)(e,2),n=t[0],r=t[1];return Object(k.jsx)(o.e,{children:r.toString()},n)}))}):null]})}var q=n(65),J=n(66),Z=n.n(J),$=function(){var e=Object(h.a)(f.a.mark((function e(t){var n,r,c,i,a,o,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Z()().format("YYYYMMDD-HHmmss"),r="ChildErrorSummary"===t?"children":"errors",c=window.pyodide;try{i=c.globals.get("report"),a=i.csv_report(r),o=new Blob([a],{type:"text/csv"}),i.destroy(),Object(q.saveAs)(o,"".concat(t,"-").concat(n,".csv"))}catch(s){console.error("Caught Error!",s),l=s.toString(),y(s,{pythonError:l})}case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ee=n(92).map((function(e){return{la_id:e.UTLA21CD,la_name:e.UTLA21NM}})).reduce((function(e,t){return e[t.la_id]=t,e}),{}),te=Object.values(ee).sort((function(e,t){return e.la_name>t.la_name?1:-1})),ne=function(){var e;window.gtag&&(e=window).gtag.apply(e,arguments)},re=function(e,t,n,r){ne("event",e,{event_category:t,event_label:n,value:r})};function ce(){var e=Object(r.useState)("Loading Python initially (takes around 30 seconds)..."),t=Object(p.a)(e,2),n=t[0],c=t[1],i=Object(r.useState)([]),a=Object(p.a)(i,2),l=a[0],s=a[1],b=Object(r.useState)([]),O=Object(p.a)(b,2),v=O[0],g=O[1],x=Object(r.useState)(),y=Object(p.a)(x,2),w=y[0],E=y[1],_=Object(r.useState)([]),A=Object(p.a)(_,2),F=A[0],D=A[1],T=Object(r.useState)(te[0].la_id),P=Object(p.a)(T,2),R=P[0],L=P[1],I=Object(r.useMemo)((function(){return function(e){var t=new Date,n=t.getFullYear();t.getMonth()<4&&(n-=1);for(var r=[n],c=1;c<e;c++)r.push(n-c);return r.map((function(e){return"".concat(e,"/").concat((e+1)%100)}))}(5)}),[]),M=Object(r.useState)(I[0]),N=Object(p.a)(M,2),H=N[0],V=N[1];Object(r.useEffect)((function(){Object(h.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C();case 2:return re("pyodide","loaded"),e.next=5,S();case 5:t=e.sent,D(t),c("");case 8:case"end":return e.stop()}}),e)})))()}),[]);var K=Object(r.useCallback)((function(e){re("click","addFile"),l.push(e),s(Object(j.a)(l))}),[l]),U=Object(r.useCallback)((function(){re("click","clear"),g([]),E(null),s([])}),[]),G=Object(r.useCallback)(Object(h.a)(f.a.mark((function e(){var t,n,r,i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return re("click","validate"),g([]),c("Loading postcode file (initial load takes 60 seconds)..."),t={localAuthority:R,collectionYear:H},c("Running validation..."),e.next=7,m(l,F,t);case 7:n=e.sent,r=Object(p.a)(n,2),i=r[0],0===(a=r[1]).length?E(i):(U(),g(a)),c("");case 13:case"end":return e.stop()}}),e)}))),[l,F,U,R,H]),B=Object(r.useCallback)(Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(re("click","download"),!w){e.next=6;break}return e.next=4,$("ErrorCounts");case 4:return e.next=6,$("ChildErrorSummary");case 6:case"end":return e.stop()}}),e)}))),[w]),W=Object(r.useCallback)((function(e){var t,n=[],r=Object(u.a)(F);try{for(r.s();!(t=r.n()).done;){var c=t.value,i=Object(d.a)({},c);i.code===e.code&&(i.selected=!i.selected),n.push(i)}}catch(a){r.e(a)}finally{r.f()}D(n)}),[F,D]),X=Object(r.useCallback)((function(e){var t,n=[],r=Object(u.a)(F);try{for(r.s();!(t=r.n()).done;){var c=t.value,i=Object(d.a)({},c);i.selected=e,n.push(i)}}catch(a){r.e(a)}finally{r.f()}D(n)}),[F,D]);Object(r.useEffect)((function(){var e=window.localStorage.getItem("localAuthority");if(e&&te.some((function(t){return t.la_id===e}))){var t=te.find((function(t){return t.la_id===e}));re("la_select","localStore",(null===t||void 0===t?void 0:t.la_name)||e),L(e)}}),[L]);var z=Object(r.useCallback)((function(e){var t=te.find((function(t){return t.la_id===e.target.value}));re("la_select","user",(null===t||void 0===t?void 0:t.la_name)||e.target.value),L(e.target.value),window.localStorage.setItem("localAuthority",e.target.value)}),[L]);return Object(k.jsxs)(k.Fragment,{children:[w?Object(k.jsx)(Y,{validatedData:w}):Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(Q,{currentFiles:l,addFileContent:K,uploadErrors:v,selectedErrors:F,setSelectedErrors:D}),Object(k.jsx)(o.r,{input:{value:H,onChange:function(e){return V(e.target.value)}},label:"Collection Year",mb:4,children:I.map((function(e){return Object(k.jsx)("option",{value:e,children:e},e)}))}),Object(k.jsx)(o.r,{input:{value:R||void 0,onChange:z},label:"Local Authority",mb:4,children:te.map((function(e){var t=e.la_id,n=e.la_name;return Object(k.jsx)("option",{value:t,children:n},t)}))})]}),Object(k.jsxs)(ie,{loading:n,children:[Object(k.jsxs)(o.d,{summary:"Validation Rules (".concat(F.filter((function(e){return e.selected})).length," selected, ").concat(F.filter((function(e){return!e.selected})).length," unselected)"),children:[Object(k.jsx)(o.a,{onClick:function(){return X(!0)},children:"Select All "})," ",Object(k.jsx)(o.a,{onClick:function(){return X(!1)},children:"Deselect All "}),F.map((function(e){return Object(k.jsxs)(o.c,{checked:e.selected,onChange:function(){return W(e)},children:[e.code," - ",e.description]},e.code)}))]}),Object(k.jsx)("div",{style:{marginRight:"10%",display:"inline"},children:Object(k.jsx)(o.a,{onClick:G,children:"Validate"})}),Object(k.jsx)("div",{style:{marginRight:"10%",display:"inline"},children:Object(k.jsx)(o.a,{onClick:U,children:"Clear Data and Start Again"})}),Object(k.jsx)("div",{style:{marginRight:"10%",display:"inline"},children:w?Object(k.jsx)(o.a,{onClick:B,children:"Download CSVs"}):Object(k.jsx)(o.a,{buttonColour:"gray",disabled:!0,children:"Download CSVs"})})]})]})}function ie(e){var t=e.children,n=e.loading;return n?Object(k.jsxs)("div",{style:{position:"relative",pointerEvents:"none"},children:[Object(k.jsxs)("div",{style:{width:"100%",position:"absolute",display:"flex",justifyContent:"center",flexWrap:"wrap"},children:[Object(k.jsx)("div",{style:{width:"100%",textAlign:"center",height:"25px",fontSize:"24px"},children:n}),Object(k.jsx)(O.e,{style:{width:"50px",height:"50px",display:"block"}})]}),Object(k.jsx)("div",{style:{opacity:"30%"},children:t})]}):t}function ae(){return Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(o.o,{children:"Click Start to begin."}),Object(k.jsx)(o.a,{start:!0,as:s.a,to:"/application",children:"Start now"})]})}var oe=function(){return Object(k.jsxs)(l.a,{children:[Object(k.jsx)(o.f,{}),Object(k.jsxs)(o.n.WidthContainer,{style:{height:"100vh",width:"75%",maxWidth:"none"},children:[Object(k.jsxs)(o.p,{level:"beta",children:["This is a new service - ",Object(k.jsx)(o.l,{href:"https://join.slack.com/t/datatoinsight/shared_invite/zt-nuw179pj-n5Glvc7S1bFbeE~l2vZf_w",children:"your feedback can help us improve it."})]}),Object(k.jsxs)(o.n.Main,{children:[Object(k.jsx)(o.i,{children:"SSDA903 Data Validation Service"}),Object(k.jsxs)(l.d,{children:[Object(k.jsx)(l.b,{path:"/application",component:ce}),Object(k.jsx)(l.b,{exact:!0,path:"/",component:ae})]})]})]})]})};n(184);!function(){try{!function(){var e="https://befe29a929f64c6a96b3f7e8e0bb82ab@o108858.ingest.sentry.io/6075367";g.a({dsn:e})}()}catch(e){console.error("Failed to initialise Sentry")}}(),function(){var e="G-S8FK1TK7L9";var t="ga-script-include";if(!document.getElementById(t)){var n=document.createElement("script");n.id=t,n.async=!0,n.src="https://www.googletagmanager.com/gtag/js?id=".concat(e),document.head.append(n);var r=document.createElement("script");r.innerHTML="\nwindow.dataLayer = window.dataLayer || [];\nfunction gtag(){dataLayer.push(arguments);}\ngtag('js', new Date());\ngtag('config', '".concat(e,"')"),document.head.append(r)}}(),ne("pageview"),a.a.render(Object(k.jsx)(c.a.StrictMode,{children:Object(k.jsx)(oe,{})}),document.getElementById("root"))}},[[185,1,2]]]);
//# sourceMappingURL=main.2334f5d7.chunk.js.map